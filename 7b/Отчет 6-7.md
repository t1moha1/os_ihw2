

## 1. Исполнитель

Тулинов Тимофей Антонович, группа БПИ-236

## 2. Условие задачи

**Вариант 25**

**Задача об инвентаризации по рядам.** После нового года в библиотеке университета обнаружилась пропажа каталога. После поиска и наказания виноватых, ректор дал указание восстановить каталог силами студентов. Фонд библиотека представляет собой прямоугольное помещение, в котором находится **M** рядов по **N** шкафов по **K** книг в каждом шкафу.
**Требуется создать многопроцессное приложение, составляющее каталог по информации, поступающей от каждого из студентов, проверяющих местоположение книг.** При решении задачи использовать метод «портфель задач».
_В качестве отдельного процесса задаётся составление каталога одним студентом для одного ряда._

## 3. Процессы

1. **Родительский процесс** (main):
    
    - Парсит параметры M N K.
        
    - Создаёт два сегмента разделяемой памяти:
        
        - LIB_SHM для исходного массива книг (int lib[M·N·K]).
            
        - CATALOG_SHM для каталога (int size + Book catalog[size]).
            
        
    - Инициализирует массив lib случайной перестановкой чисел от 1 до M·N·K.
        
    - Создаёт неименованный семафор со счётчиком = 1, кладет его в начало CATALOG_SHM
        
    - Порождает **M** дочерних процессов — по одному на каждый ряд.
        
    
2. **Дочерний процесс** (для ряда r):
    
    - Читает из lib ровно N·K элементов, соответствующих его ряду.
        
    - Создаёт локальный массив row_books[] структур Book, заполняет поля title, row = r, col, pos.
        
    - Вызывает qsort() для сортировки row_books по title.
        
    - Захватывает семафор sem_wait(sem_cat).
        
    - Читает текущее значение catalog_size и существующий массив catalog[] из разделяемой памяти.
        
    - Сливает (merge) два отсортированных массива: старый catalog[] и свой row_books[].
        
    - Записывает новый объединённый массив в сегмент CATALOG_SHM, обновляет catalog_size.
        
    - Отпускает семафор sem_post(sem_cat).
        
    - Завершает работу.
        
    
3. **Родительский процесс**:
    
    - Ожидает завершения всех **M** детей через waitpid().
        
    - После чего выводит окончательный каталог, считанный из CATALOG_SHM.
        
    - Очищает все ресурсы.

## 4. Описание программы

Программа использует два экземпляра разделяемой памяти, одна для хранения книг в библиотеке, другая для каталога. Несколько процессов создают свои каталоги, после сливают их в общий, корректность работы гарантирует неименованный семафор. Неименованный семафор, передается через память каталога. За освобождение всех ресурсов отвечает специальная функция, которая вызывается в случае завершении программы(в том числе аварийного). Так же реализован обработчик сигналов.

## 5. Формат командной строки

```bash

./program M N K
```

## 6. Тесты
```bash

./run_tests.sh
```

Test 1:
Блок отделенный --- это ряд библиотеки, каждая строка в блоке это шкаф
Исходное положение(ряд(row), колонка(col), номер в шкафу(pos) -> название):
(0,0,0)->35  (0,0,1)->4  (0,0,2)->23  (0,0,3)->7  
(0,1,0)->32  (0,1,1)->26  (0,1,2)->13  (0,1,3)->5  
 (0,2,0)->24  (0,2,1)->15  (0,2,2)->1  (0,2,3)->17  
------------------------------------
(1,0,0)->20  (1,0,1)->11  (1,0,2)->8  (1,0,3)->27  
(1,1,0)->9  (1,1,1)->10  (1,1,2)->3  (1,1,3)->30  
 (1,2,0)->28  (1,2,1)->33  (1,2,2)->16  (1,2,3)->6 
------------------------------------
(2,0,0)->22  (2,0,1)->21  (2,0,2)->29  (2,0,3)->34  
(2,1,0)->25  (2,1,1)->18  (2,1,2)->31  (2,1,3)->12  
 (2,2,0)->19  (2,2,1)->2  (2,2,2)->36  (2,2,3)->14  
------------------------------------

Каталог:
Название:1 -> (ряд(row) 0, колонка(col) 2, номер в шкафу(pos) 2)
Название:2 -> (ряд(row) 2, колонка(col) 2, номер в шкафу(pos) 1)
Название:3 -> (ряд(row) 1, колонка(col) 1, номер в шкафу(pos) 2)
Название:4 -> (ряд(row) 0, колонка(col) 0, номер в шкафу(pos) 1)
Название:5 -> (ряд(row) 0, колонка(col) 1, номер в шкафу(pos) 3)
Название:6 -> (ряд(row) 1, колонка(col) 2, номер в шкафу(pos) 3)
Название:7 -> (ряд(row) 0, колонка(col) 0, номер в шкафу(pos) 3)
Название:8 -> (ряд(row) 1, колонка(col) 0, номер в шкафу(pos) 2)
Название:9 -> (ряд(row) 1, колонка(col) 1, номер в шкафу(pos) 0)
Название:10 -> (ряд(row) 1, колонка(col) 1, номер в шкафу(pos) 1)
Название:11 -> (ряд(row) 1, колонка(col) 0, номер в шкафу(pos) 1)
Название:12 -> (ряд(row) 2, колонка(col) 1, номер в шкафу(pos) 3)
Название:13 -> (ряд(row) 0, колонка(col) 1, номер в шкафу(pos) 2)
Название:14 -> (ряд(row) 2, колонка(col) 2, номер в шкафу(pos) 3)
Название:15 -> (ряд(row) 0, колонка(col) 2, номер в шкафу(pos) 1)
Название:16 -> (ряд(row) 1, колонка(col) 2, номер в шкафу(pos) 2)
Название:17 -> (ряд(row) 0, колонка(col) 2, номер в шкафу(pos) 3)
Название:18 -> (ряд(row) 2, колонка(col) 1, номер в шкафу(pos) 1)
Название:19 -> (ряд(row) 2, колонка(col) 2, номер в шкафу(pos) 0)
Название:20 -> (ряд(row) 1, колонка(col) 0, номер в шкафу(pos) 0)
Название:21 -> (ряд(row) 2, колонка(col) 0, номер в шкафу(pos) 1)
Название:22 -> (ряд(row) 2, колонка(col) 0, номер в шкафу(pos) 0)
Название:23 -> (ряд(row) 0, колонка(col) 0, номер в шкафу(pos) 2)
Название:24 -> (ряд(row) 0, колонка(col) 2, номер в шкафу(pos) 0)
Название:25 -> (ряд(row) 2, колонка(col) 1, номер в шкафу(pos) 0)
Название:26 -> (ряд(row) 0, колонка(col) 1, номер в шкафу(pos) 1)
Название:27 -> (ряд(row) 1, колонка(col) 0, номер в шкафу(pos) 3)
Название:28 -> (ряд(row) 1, колонка(col) 2, номер в шкафу(pos) 0)
Название:29 -> (ряд(row) 2, колонка(col) 0, номер в шкафу(pos) 2)
Название:30 -> (ряд(row) 1, колонка(col) 1, номер в шкафу(pos) 3)
Название:31 -> (ряд(row) 2, колонка(col) 1, номер в шкафу(pos) 2)
Название:32 -> (ряд(row) 0, колонка(col) 1, номер в шкафу(pos) 0)
Название:33 -> (ряд(row) 1, колонка(col) 2, номер в шкафу(pos) 1)
Название:34 -> (ряд(row) 2, колонка(col) 0, номер в шкафу(pos) 3)
Название:35 -> (ряд(row) 0, колонка(col) 0, номер в шкафу(pos) 0)
Название:36 -> (ряд(row) 2, колонка(col) 2, номер в шкафу(pos) 2)